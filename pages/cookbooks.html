<!DOCTYPE html>
<html>

<style>
.navigation_list {
    list-style-type: none;
    margin: 0;
    padding: 0;
    overflow: hidden;
    background-color: #5d2025;
}
.navigation {
    float: left;
}
.navigation a {
    display: block;
    color: white;
    text-align: center;
    padding: 14px 16px;
    text-decoration: none;
    font-size: 14px;
}
.navigation_list {
    position:sticky;
    top:0;
    z-index: 300;
}
.navigation a:hover {
    background-color: gray;
    text-decoration: none;
}
.recipe-links:hover {
    cursor: pointer;
}
body {
    background-color: rgb(251, 251, 251);
    background-image: url(../images/background.svg);
    background-repeat: repeat;
    background-position: center top;
}
.error {
    color: red;
}
.custom-input {
    width: 100%;
    padding: 12px 20px;
    margin: 0 0 8px 0;
    display: inline-block;
    border: 1px solid #ccc;
    box-sizing: border-box;
    text-align: center;
}
.list-item {
    display: flex;
    height: auto;
    width: 95%;
    padding: 10px;
    border-radius: 5px;
    margin: 20px 0;
    border: 3px solid #5d2025;
    background-color: #f9f9f9;
}
.hidden {
    display: none;
}
.img-container {
    display: inherit;
    width: 150px;
    height: 150px;
}
.text-container {
    margin-left: 10px;
    display: flex;
}
.inner-text-container {
    padding: 0 10px;
}
.title-text {
    font-weight: bold;
    margin-bottom: 6px;
    text-align: center;
    width: 50%;
    align-items: center;
    overflow: hidden;
    margin: auto;
}
.button-container {
    font-size: 30px;
    font-weight: bold;
    align-items: center;
}
.body-text {
    display: inherit;
    overflow: hidden;
    margin: auto;
}
.delete-button {
    float:right;
    padding-right: 10px;
}
.edit-button {
    margin-left: 10px;
}
.add-button {
    float:right;
}
.delete-button:hover {
    cursor: pointer;
    text-decoration: none;
}
.add-button:hover {
    cursor: pointer;
    text-decoration: none;
}
.edit-button:hover {
    cursor: pointer;
    text-decoration: none;
}
.img-displayed {
    display: inherit;
    margin: 4px;
    border: 3px solid #5d2025;
    border-radius: 5px;
    width: 100%;
}
.search-cookbooks button:hover {background-color: #3e8e41}
.search-cookbooks button:active {
    background-color: #3e8e41;
    box-shadow: 0 5px #666;
    transform: translateY(4px);
}
.search-cookbooks {
    width: 80%;
    padding: 5px;
    margin: auto;
    margin-top: 20px;
    margin-bottom: 10px;
}
.text-center {
    text-align: center;
    color: #5d2025;
    font-weight: bold;
}
.cookbook-list {
    align-items: center;
}
.select-container {
    margin-bottom: 10px;
}
@media screen and (min-width: 601px) {
    .list-item {
        width: 95%;
    }
    .title-text {
       font-size: 30px; 
    }
    .body-text {
      width: 50%;
    }
    .text-container {
      width: 85%;
    }
}
@media screen and (max-width: 600px) {
    .list-item {
        flex-wrap: wrap;
        justify-content: center;
        width: 85%;
    }
    .text-container {
        flex-wrap: wrap;
        justify-content: center;
    }
    .title-text {
       font-size: 20px; 
    }
    .navigation_list {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
    }
    .text-container {
      width: 100%;
    }
    .body-text {
      width: 100%;
    }
}
</style>

<head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/1.3.1/css/toastr.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/css/bootstrap-multiselect.css" />
<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../favicon.ico"/>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cookbooks</title>
</head>

<body>
<ul class="navigation_list">
    <li class="navigation"><a href="recipes.html">Recipes</a></li>
    <li class="navigation"><a href="my_recipes.html">My Recipes</a></li>
    <li class="navigation"><a href="cookbooks.html">Cookbooks</a></li>
    <li class="navigation"><a href="favorite_recipes.html">Favorite Recipes</a></li>
    <li class="navigation"><a href="profile.html">Profile</a></li>
    <li class="navigation"><a href="about.html">About</a></li>
    <li class="navigation" style="float:right;"><a href="login.html">Log out</a></li>
</ul>
<h1 class="text-center">Cookbooks</h1>

<div class="search-cookbooks">
    <i type="button" class="fa fa-plus fa-2x add-button" data-toggle="modal" onclick="open_modal_add_cookbook()"></i>
    <input type="text" name="cook-search" id="cookbooks-search" placeholder="&#128269; Search cookbooks" class="form-control"/>
</div>

<div class="container">
    <ul id="list-of-cookbooks" class="cookbook-list" style="padding-left: 55px;">
      <div class="row">
        
      <div id="lista"></div>


          <!-- <li class="list-item" id="cookbook-1">
            <div class="img-container">
                <img src="../images/eat_king.jpg" alt="Avatar" class="img-displayed">
            </div>

            <div class="text-container">
              <div class="title-text">Eat like a king<i class="fa fa-pencil edit-button" onclick="edit_cookbook(1)"></i></div>
                <div class="body-text">
                  <ul>
                      <div onclick="openRecipeInfo(1)" class="recipe-links">- Skillet Chicken Bulgogi</div>
                      <div onclick="openRecipeInfo(3)" class="recipe-links">- Omelet in a Mug</div>
                      <div onclick="openRecipeInfo(4)" class="recipe-links">- Grandma's Salmon Cakes</div>
                  </ul>  
                </div>
              </div>
              <div class="button-container"><i class="fa fa-trash-o delete-button" onclick="confirm_modal_show(1)"></i></div>
          </li>

          <li class="list-item" id="cookbook-2">
            <div class="img-container">
                <img src="../images/breakfast_for_a_king.jpg" alt="Avatar" class="img-displayed">
            </div>

            <div class="text-container">
              <div class="title-text">Perfect Breakfast<i class="fa fa-pencil edit-button" onclick="edit_cookbook(2)"></i></div>
                <div class="body-text">
                  <ul>
                      <div onclick="openRecipeInfo(2)" class="recipe-links">- Andie's Sloppy Joes</div>
                      <div onclick="openRecipeInfo(1)" class="recipe-links">- Skillet Chicken Bulgogi</div>
                      <div onclick="openRecipeInfo(3)" class="recipe-links">- Omelet in a Mug</div>
                  </ul>  
                </div>
                <div class="button-container"><i class="fa fa-trash-o delete-button" onclick="confirm_modal_show(2)"></i></div>
            </li>

          <li class="list-item" id="cookbook-3">
            <div class="img-container">
                <img src="../images/easy_meal.jpg" alt="Avatar" class="img-displayed">
            </div>

            <div class="text-container">
              <div class="title-text">Easy Meals<i class="fa fa-pencil edit-button" onclick="edit_cookbook(3)"></i></div>
                <div class="body-text">
                  <ul>
                      <div onclick="openRecipeInfo(5)" class="recipe-links">- Klupskies (Polish Burgers)</div>
                      <div onclick="openRecipeInfo(3)" class="recipe-links">- Omelet in a Mug</div>
                      <div onclick="openRecipeInfo(1)" class="recipe-links">- Skillet Chicken Bulgogi</div>
                  </ul>  
                </div>
                <div class="button-container"><i class="fa fa-trash-o delete-button" onclick="confirm_modal_show(3)"></i></div>
            </li> -->
        </div>  
    </ul>  
</div>

<div class="modal fade" id="add-cookbook-modal" tabindex="-1" role="dialog" aria-labelledby="addCookbookModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <form id="add-cookbook-form">
        <div class="modal-header">
          <h4 class="modal-title" id="add-cookbook-modal-label" style="display:inline-block;">Add new cookbook</h4>
            <button type="button" style="display:inline-block;" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            </button>
        </div>

        <div class="modal-body">
          <div>
            <label><b>Cookbook name</b></label>
            <input class="custom-input" type="text" name="cookbook-name" required>
          </div>
          <div class="select-container">
            <label><b>Recipes</b></label>
              <select id="recipes-1" name="recipes" multiple class="form-control" required>
                <div id="cookbook_recipe_options_add"></div>
                <option value="1">Skillet Chicken Bulgogi</option>
                <option value="2">Omelet in a Mug</option>
                <option value="3">Grandma's Salmon Cakes</option>
                <option value="4">Klupskies (Polish Burgers)</option>
                <option value="5">Andie's Sloppy Joes</option>
              </select>
          </div>

          <!-- <div>
            <label><b>Dish picture (.png, .gif, .jpeg, .jpg allowed)</b></label>
            <input type="file" name="file" accept="image/jpg,image/png,image/jpeg,image/gif" required/>
          </div> -->
          <div>
            <label><b>Choose the cookbook picture</b></label>
            <select id="cookbook_picture_add" name="cookbook_pictures_add">
              <div id="cookbook_picture_options_add"></div>
            </select>
          </div>
        </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Submit</button>
          </div>
        </form>
      </div>
    </div>
</div>

<div class="modal fade" id="edit-cookbook-modal" tabindex="-1" role="dialog" aria-labelledby="editCookbookModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <form id="edit-cookbook-form">
        <div class="modal-header">
          <h4 class="modal-title" id="edit-cookbook-modal-label" style="display:inline-block;">Edit cookbook</h4>
            <button type="button" style="display:inline-block;" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            </button>
        </div>

        <div class="modal-body">
          <input style="display:none" name="cookbook_id">
          <div>
            <label><b>Cookbook name</b></label>
            <input class="custom-input" type="text" name="cookbook-name" value="Cookbook 1" required>
          </div>
            <!-- <div class="select-container">
              <label><b>Recipes (If none are selected, the previously selected recipes will remain</b></label>
              <select id="recipes-2" name="recipes" multiple class="form-control">
                <div id="cookbook_recipe_options_edit"></div>
                <option value="1">Skillet Chicken Bulgogi</option>
                <option value="2">Omelet in a Mug</option>
                <option value="3">Grandma's Salmon Cakes</option>
                <option value="4">Klupskies (Polish Burgers)</option>
                <option value="5">Andie's Sloppy Joes</option>
              </select>
            </div> -->
            
          <div>
            <label><b>Choose the cookbook picture</b></label>
            <select id="cookbook_picture_edit" name="cookbook_pictures_edit">
              <div id="cookbook_picture_options_edit"></div>
            </select>
          </div>
            <!-- <div>
              <label><b>Dish picture (.png, .gif, .jpeg, .jpg allowed)</b></label>
              <label><b>Hint: If no file is chosen, the previously uploaded picture will be displayed</b></label>
              <input type="file" name="file" accept="image/jpg,image/png,image/jpeg,image/gif"/>
            </div> -->
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Submit</button>
          </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="delete-cookbook-modal" tabindex="-1" role="dialog" aria-labelledby="deleteCookbookModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <form id="delete-cookbook-form">
        <div class="modal-header" style="text-align: center;">
          <h4 class="modal-title" id="delete-cookbook-modal-label" style="display:inline-block;">Are you sure?</h4>
          <input style="display:none" name="cookbook_id">
        </div>
        <div class="modal-footer" style="border: none;">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
          <button type="submit" class="btn btn-danger">Delete</button>
        </div>
      </form>
    </div>
  </div>
</div>

</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.1/dist/jquery.validate.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/1.3.1/js/toastr.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/js/bootstrap-multiselect.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-3-typeahead/4.0.2/bootstrap3-typeahead.min.js"></script>

<script>

$('#edit-cookbook-modal').on('shown.bs.modal', function () {
  var selected_image = localStorage.getItem('selected_image');
  $('#edit-cookbook-form select[name="cookbook_pictures_edit"]').val(selected_image);
});


function get_all_recipes() {
$.get( "../rest/recipes", null ).done(function(data) {
  data.forEach(element => {
    data.forEach(element => {
        document.getElementById('cookbook_picture_add').innerHTML+='<option value="' + element.url + '">' + element.name + '</option>';
    });
  });
  }).fail(function(error) {
    toastr.error(error.responseText) 
  });
}

// function get_cookbook_recipes_for_dropdown(type) {
//   if (type == 0) {
//     $.get( "../rest/recipes", null ).done(function(data) {
//       document.getElementById('recipes-1').innerHTML = '';
//         data.forEach(element => {
//           console.log(element.id)
//             document.getElementById('recipes-1').innerHTML+='<option value="' + element.id + '">' + element.recipe_name + '</option>';
//         });
//       }).fail(function(error) {
//         toastr.error(error.responseText) 
//       });
//   } else if (type == 1) {
//     $.get( "../rest/recipes", null ).done(function(data) {
//       document.getElementById('recipes-2').innerHTML = '';
//         data.forEach(element => {
//             document.getElementById('recipes-2').innerHTML+='<option value="' + element.id + '">' + element.recipe_name + '</option>';
//         });
//       }).fail(function(error) {
//         toastr.error(error.responseText) 
//       });
//   }
// }


get_cookbooks();

function get_cookbooks() {
  $.ajax({
    url: "../rest/cookbooks",
    type: "GET",
    beforeSend: function(xhr) {
      xhr.setRequestHeader('Authorization', 'Bearer ' +  localStorage.getItem("user_token"));
    },
    success: function( data ) {
      document.getElementById('lista').innerHTML = "";
      data.forEach(element => {
        if (element.recipe_1_name != null && element.recipe_2_name != null && element.recipe_3_name != null) {
          document.getElementById('lista').innerHTML+='<li class="list-item" id="cookbook-' + element.id + '"><div class="img-container"><img src="' + element.image_url + '" alt="Avatar" class="img-displayed"></div><div class="text-container"><div class="title-text">' + element.name + '<i class="fa fa-pencil edit-button" onclick="open_modal_edit_cookbook(' + element.id + ')"></i></div><div class="body-text"><ul><div onclick="openRecipeInfo(' + element.recipe_1_id + ')" class="recipe-links">- ' + element.recipe_1_name + '</div><div onclick="openRecipeInfo(' + element.recipe_2_id + ')" class="recipe-links">- ' + element.recipe_2_name + '</div><div onclick="openRecipeInfo(' + element.recipe_3_id + ')" class="recipe-links">- ' + element.recipe_3_name + '</div></ul></div></div><div class="button-container"><i class="fa fa-trash-o delete-button" onclick="open_modal_delete_cookbook(' + element.id +')"></i></div></li>';
        } else if (element.recipe_1_name != null && element.recipe_2_name != null && element.recipe_3_name == null) {
          document.getElementById('lista').innerHTML+='<li class="list-item" id="cookbook-' + element.id + '"><div class="img-container"><img src="' + element.image_url + '" alt="Avatar" class="img-displayed"></div><div class="text-container"><div class="title-text">' + element.name + '<i class="fa fa-pencil edit-button" onclick="open_modal_edit_cookbook(' + element.id + ')"></i></div><div class="body-text"><ul><div onclick="openRecipeInfo(' + element.recipe_1_id + ')" class="recipe-links">- ' + element.recipe_1_name + '</div><div onclick="openRecipeInfo(' + element.recipe_2_id + ')" class="recipe-links">- ' + element.recipe_2_name + '</div></ul></div></div><div class="button-container"><i class="fa fa-trash-o delete-button" onclick="open_modal_delete_cookbook(' + element.id +')"></i></div></li>';
        } else if (element.recipe_1_name != null && element.recipe_2_name == null && element.recipe_3_name == null) {
          document.getElementById('lista').innerHTML+='<li class="list-item" id="cookbook-' + element.id + '"><div class="img-container"><img src="' + element.image_url + '" alt="Avatar" class="img-displayed"></div><div class="text-container"><div class="title-text">' + element.name + '<i class="fa fa-pencil edit-button" onclick="open_modal_edit_cookbook(' + element.id + ')"></i></div><div class="body-text"><ul><div onclick="openRecipeInfo(' + element.recipe_1_id + ')" class="recipe-links">- ' + element.recipe_1_name + '</div></ul></div></div><div class="button-container"><i class="fa fa-trash-o delete-button" onclick="open_modal_delete_cookbook(' + element.id +')"></i></div></li>';
        }
  });
    },
    error: function(){
      toastr.error(error.responseText) 
    }
  });
}




function confirm_modal_show(i) {
  $("#confirm-modal").modal('show');
  localStorage.setItem('delete_cookbook_id', i);
}

function delete_cookbook() {
  i = localStorage.getItem('delete_cookbook_id');
  if (i == 1) {
        document.getElementById("cookbook-1").className = "hidden";
        toastr.error('Cookbook deleted');
    } else if (i == 2) {
        document.getElementById("cookbook-2").className = "hidden";
        toastr.error('Cookbook deleted');
    } else if (i == 3) {
        document.getElementById("cookbook-3").className = "hidden";
        toastr.error('Cookbook deleted');
    }
}

$('#confirm-form').validate({
  submitHandler: function(form) {
    delete_cookbook();
    $("#confirm-modal").modal('hide');
}
});

function openRecipeInfo(i) {

  $.get( "../rest/recipe/" + i, null ).done(function(data) {

    localStorage.setItem('recipe_image_url', data.image_url);
    localStorage.setItem('recipe_name', data.recipe_name);
    localStorage.setItem('recipe_ingredients', data.ingredients);
    localStorage.setItem('recipe_cooking_process', data.cooking_steps);
    localStorage.setItem('cooking_timer', data.time);
    window.location = 'recipe_info.html';
  }).fail(function(error) {
    toastr.error(error.responseText) 
  });

    // if (i == 1) {
    //     localStorage.setItem('recipe_image_url', '../images/recipe_1.jpg');
    //     localStorage.setItem('recipe_name', 'Skillet Chicken Bulgogi');
    //     localStorage.setItem('recipe_ingredients', '1/4 cup chopped onion \n5 tablespoons soy sauce \n2.5 tablespoons brown sugar \n2 tablespoons minced garlic \n2 tablespoons sesame oil \n1 tablespoon sesame seeds \n1/2 teaspoon cayenne \nsalt and ground black pepper to taste \n1 pound skinless boneless chicken breasts cut into thin strips \n');
    //     localStorage.setItem('recipe_cooking_process', 'Step 1: \nWhisk onion, soy sauce, brown sugar, garlic, sesame oil, sesame seeds, cayenne pepper, salt, and black pepper together in a bowl until marinade is smooth.\nStep 2: \nCook and stir chicken and marinade together in a large skillet over medium-high heat until chicken is cooked through, about 15 minutes.');
    //     localStorage.setItem('cooking_timer', 15);
    //     window.location = 'recipe_info.html';
    // } else if (i == 2) {
    //     localStorage.setItem('recipe_image_url', '../images/recipe_2.jpg');
    //     localStorage.setItem('recipe_name', "Andie's Sloppy Joes");
    //     localStorage.setItem('recipe_ingredients', '1 cup lentils \n2 onions diced \n1 pound lean ground beef \n1 large green bell pepper diced \n3/4 cup ketchup \n3/4 cup barbeque sauce \n1 tablespoon Worcestershire sauce \n1 tablespoon minced garlic');
    //     localStorage.setItem('recipe_cooking_process', 'Step 1: \nPlace lentils in a small pot and cover with 2 cups hot water. Bring to a boil; reduce heat and simmer until lentils are tender, about 15 minutes. Drain.\nStep 2: \nHeat a large nonstick skillet over medium heat. Add onions; cook and stir until softened, 3 to 5 minutes. Add ground beef and green bell pepper; cook and stir until browned, about 8 minutes. \nStep 3: \nStir drained lentils, ketchup, barbeque sauce, Worcestershire sauce, and minced garlic into the skillet. Reduce heat to low and simmer until flavors combine and mixture thickens to desired consistency, 15 to 20 minutes.');
    //     localStorage.setItem('cooking_timer', 46);
    //     window.location = 'recipe_info.html';
    // } else if (i == 3) {
    //     localStorage.setItem('recipe_image_url', '../images/recipe_3.jpg');
    //     localStorage.setItem('recipe_name', 'Omelet in a Mug');
    //     localStorage.setItem('recipe_ingredients', '1 large egg \n2 egg whites \n2 tablespoons shredded Cheddar cheese \n2 tablespoons diced fully cooked ham \n1 tablespoon diced green bell pepper \nsalt and ground black pepper to taste \ncooking spray');
    //     localStorage.setItem('recipe_cooking_process', 'Step 1: \nCombine egg, egg whites, Cheddar cheese, ham, bell pepper, salt, and ground pepper in a microwave-safe mug coated with non-stick spray.\nStep 2: \nMicrowave on high for 1 minute; stir. Return to microwave and cook until eggs are completely set, 1 to 1 1/2 minutes longer.');
    //     localStorage.setItem('cooking_timer', 2);
    //     window.location = 'recipe_info.html';
    // } else if (i == 4) {
    //     localStorage.setItem('recipe_image_url', '../images/recipe_4.jpg');
    //     localStorage.setItem('recipe_name', "Grandma's Salmon Cakes");
    //     localStorage.setItem('recipe_ingredients', '1 (14.75 ounce) can salmon drained and flaked \n2 eggs, beaten \n1 small onion, diced \n1 teaspoon ground black pepper \n3 tablespoons vegetable oil');
    //     localStorage.setItem('recipe_cooking_process', 'Step 1: \nPick through the salmon and remove any bones. In a mixing bowl, beat the eggs and add the diced onion, salmon and pepper. Mix thoroughly.\nStep 2: \nShape into 2 ounce patties; about 7 or 8 patties. In a large skillet over medium heat, heat the oil. Fry each patty for 5 minutes on each side or until crispy and golden brown.');
    //     localStorage.setItem('cooking_timer', 20);
    //     window.location = 'recipe_info.html';
    // } else if (i == 5) {
    //     localStorage.setItem('recipe_image_url', '../images/recipe_5.jpg');
    //     localStorage.setItem('recipe_name', 'Klupskies (Polish Burgers)');
    //     localStorage.setItem('recipe_ingredients', '1 pound ground beef \n1 small onion, diced \n1/2 green pepper, diced \n1 large green bell pepper diced \n1 egg \n2 tablespoons ketchup \n1/4 teaspoon sea salt \n2 slices white bread, torn into small pieces \n1 serving cooking spray with olive oil');
    //     localStorage.setItem('recipe_cooking_process', 'Step 1: \nMix ground beef, onion, green pepper, egg, ketchup, and sea salt together in a bowl; mix in the white bread pieces until evenly distributed. Form the mixture into 4 patties.\nStep 2: \nSpray a large skillet with olive oil cooking spray and set over medium heat. Cook the burgers until well-browned on the bottoms, about 10 minutes; flip the burgers and cook until the meat is no longer pink and the juices run clear, 8 to 10 more minutes.');
    //     localStorage.setItem('cooking_timer', 20);
    //     window.location = 'recipe_info.html';
    // }
}

// function edit_cookbook(i) {
//     if (i == 1) {
//         $("#edit-cookbook-modal").modal('toggle');
//         $('#edit-cookbook-form input[name="cookbook-name"]').val("Eat like a king");
//         $('#edit-recipe-form input[name="file"]').val("");
//     } else if (i == 2) {
//         $("#edit-cookbook-modal").modal('toggle');
//         $('#edit-cookbook-form input[name="cookbook-name"]').val("Perfect Breakfast");
//         $('#edit-recipe-form input[name="file"]').val("");
//     } else if (i == 3) {
//         $("#edit-cookbook-modal").modal('toggle');
//         $('#edit-cookbook-form input[name="cookbook-name"]').val("Easy meals");
//         $('#edit-recipe-form input[name="file"]').val("");
//     }
// }

function get_cookbook_images_for_dropdown(type) {
  if (type == 0) {
  $.get( "../rest/cookbook_images", null ).done(function(data) {
    document.getElementById('cookbook_picture_add').innerHTML = "";
    data.forEach(element => {
        document.getElementById('cookbook_picture_add').innerHTML+='<option value="' + element.url + '">' + element.name + '</option>';
    });
    }).fail(function(error) {
      toastr.error(error.responseText) 
    });
  } else if (type == 1) {
  $.get( "../rest/cookbook_images", null ).done(function(data) {
    document.getElementById('cookbook_picture_edit').innerHTML = "";
    data.forEach(element => {
        document.getElementById('cookbook_picture_edit').innerHTML+='<option value="' + element.url + '">' + element.name + '</option>';
    });
    }).fail(function(error) {
      toastr.error(error.responseText) 
    });
  }
}

function get_all_recipes() {
  $.get( "../rest/recipes", null ).done(function(data) {
    recipes = data;
  }).fail(function(error) {
    toastr.error(error.responseText) 
  });
}
var recipes;
function open_modal_add_cookbook(){
    get_cookbook_images_for_dropdown(0);
    get_all_recipes();
    // get_cookbook_recipes_for_dropdown(0);
    $("#add-cookbook-modal").modal("toggle");
  }

$('#add-cookbook-form').validate({
  submitHandler: function(form) {
    
    var selected_recipe_list = $('#add-cookbook-form select[id="recipes-1"]').val();

    if ($('#add-cookbook-form select[id="recipes-1"] :selected').length > 2) {
      var cookbook = {
        name: $('#add-cookbook-form input[name="cookbook-name"]').val(),
        image_url: $('#add-cookbook-form select[name="cookbook_pictures_add"]').val(),
        recipe_1_id: null,
        recipe_2_id: null,
        recipe_3_id: null,
        recipe_1_name: null,
        recipe_2_name: null,
        recipe_3_name: null,
        user_id: '',
        }
    } else if ($('#add-cookbook-form select[id="recipes-1"] :selected').length = 2) {
      var cookbook = {
        name: $('#add-cookbook-form input[name="cookbook-name"]').val(),
        image_url: $('#add-cookbook-form select[name="cookbook_pictures_add"]').val(),
        recipe_1_id: null,
        recipe_2_id: null,
        recipe_1_name: null,
        recipe_2_name: null,
        user_id: '',
        }
    } else if ($('#add-cookbook-form select[id="recipes-1"] :selected').length = 1) {
      var cookbook = {
        name: $('#add-cookbook-form input[name="cookbook-name"]').val(),
        image_url: $('#add-cookbook-form select[name="cookbook_pictures_add"]').val(),
        recipe_1_id: null,
        recipe_1_name: null,
        user_id: '',
        }
    } else {
      toastr.error("All required fields are not filled");
      return;
    }

    increment = 1;
    selected_recipe_list.forEach(element => {

      if (increment > 3) {
        increment = 1;
      }
      cookbook['recipe_'+increment+'_id'] = element;
      cookbook['recipe_'+increment+'_name'] = recipes[element].recipe_name;
      increment++;
      console.log(cookbook);
    });


    $.ajax({
      url: "../rest/cookbook_info",
      type: "POST",
      data: cookbook,
      beforeSend: function(xhr) {
        xhr.setRequestHeader('Authorization', 'Bearer ' +  localStorage.getItem("user_token"));
      },
      success: function( data ) {
        toastr.success('You added a new cookbook');
        $('#add-cookbook-modal').modal('toggle');
        get_cookbooks();
      },
      error: function(){
        toastr.error(error.responseText) 
      }
    });



    // var cookbook = {
    // name: $('#add-cookbook-form input[name="cookbook-name"]').val(),
    // recipes: $('#add-cookbook-form select[name="recipes"]').val(),
    // image: $('#add-cookbook-form input[name="file"]').val()
    // }
    // var dish_image = cookbook.image.split('.').pop().toLowerCase();
    // if ($.inArray(dish_image, ['gif', 'png', 'jpg', 'jpeg']) == -1) {
    //     toastr.error("Uploaded file type is not allowed. Please select an image type.");
    // } else if (cookbook.name != "" && cookbook.recipes.length != 0) {
    //     toastr.success('Cookbook added successfully');
    // } else {
    //     toastr.error("Recipes for the cookbook are not selected");
    // }
}
});

function open_modal_edit_cookbook(i) {
  $.get( "../rest/cookbook/" + i, null ).done(function(data) {
    $("#edit-cookbook-modal").modal('toggle');
    $('#edit-cookbook-form input[name="cookbook_id"]').val(data.id);
    $('#edit-cookbook-form input[name="cookbook-name"]').val(data.name);
    localStorage.setItem('selected_image', data.image_url);
    get_cookbook_images_for_dropdown(1);
  }).fail(function(error) {
    toastr.error(error.responseText) 
  });
}

$('#edit-cookbook-form').validate({
  submitHandler: function(form) {
    // var cookbook = {
    // id: $('#edit-cookbook-form input[name="cookbook_id"]').val(),
    // name: $('#edit-cookbook-form input[name="cookbook-name"]').val(),
    // recipes: $('#edit-cookbook-form select[name="recipes"]').val(),
    // image: $('#edit-cookbook-form input[name="file"]').val()
    // }
    var cookbook = {
      id: $('#edit-cookbook-form input[name="cookbook_id"]').val(),
      name: $('#edit-cookbook-form input[name="cookbook-name"]').val(),
      image_url: $('#edit-cookbook-form select[name="cookbook_pictures_edit"]').val(),
    }
    $.post( "../rest/cookbook/" + cookbook.id, cookbook ).done(function(data) {
            toastr.success('Cookbook edited successfully');
            $('#edit-cookbook-modal').modal('toggle');
            get_cookbooks();
            }).fail(function(error) {
              toastr.error(error.responseText) 
            });
    
}
});

function open_modal_delete_cookbook(id) {
  $("#delete-cookbook-modal").modal('show');
  $('#delete-cookbook-form input[name="cookbook_id"]').val(id);
}


$('#delete-cookbook-form').validate({
  submitHandler: function(form) {
    var cookbook_id =  $('#delete-cookbook-form input[name="cookbook_id"]').val();
  
    $.ajax({
          url: '../rest/cookbook/'+cookbook_id,
          method: 'DELETE',
          success: function(result) {
              toastr.success('Deleted');
              get_cookbooks();
          },
          error: function(){
            toastr.success('Not deleted');
          }
      });
  $("#delete-cookbook-modal").modal('hide');
  }
});


$(document).ready(function() {
    $('#recipes-1').multiselect({
        nonSelectedText: 'Choose recipes',
        enableFiltering: true,
        enableCaseInsensitiveFiltering: true,
        buttonWidth:'100%'
 });
 $('#recipes-2').multiselect({
        nonSelectedText: 'Choose recipes',
        enableFiltering: true,
        enableCaseInsensitiveFiltering: true,
        buttonWidth:'100%'
 });
  $("#cookbooks-search").keyup(function() {
    search_table($(this).val());
  });

function search_table(value) {
  $('#list-of-cookbooks li').each(function() {
    var found = 'false';
    $(this).each(function() {
      if ($(this).text().toLowerCase().indexOf(value.toLowerCase()) >= 0) {
        found = 'true';
      }
    });
    if (found == 'true') {
      $(this).show();
    } else {
      $(this).hide();
    }
  });
}
});

</script>
</html>